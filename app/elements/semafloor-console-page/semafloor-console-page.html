<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="semafloor-console-page-theme.html">

<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner-lite.html">

<dom-module id="semafloor-console-page">
  <template strip-whitespace>
    <style include="semafloor-console-page-theme"></style>

    <div class="selection-menu">
      <paper-icon-button icon="icons:chevron-left" on-tap="_prevDayWeekMonth"></paper-icon-button>
      <paper-button class="" on-tap="_toggleCollapse">
        <span>[[_selectedRoomName]]</span>
        <iron-icon id="menuDropDown" class="menu-drop-down" icon="icons:arrow-drop-down"></iron-icon>
      </paper-button>
      <paper-icon-button icon="icons:chevron-right" on-tap="_nextDayWeekMonth"></paper-icon-button>
    </div>
    <iron-collapse id="selectionCollapse">
      <paper-tabs id="siteTabs" selected="{{site}}">
        <paper-tab>KLB - Tower 5</paper-tab>
        <paper-tab>KLB - Tower 2A</paper-tab>
        <paper-tab>SUITE</paper-tab>
      </paper-tabs>
      <paper-tabs id="floorTabs" selected="{{floor}}" scrollable>
        <template is="dom-repeat" items="[[_floors]]" index-as="index" strip-whitespace>
          <paper-tab class="floor-tab">[[item]]</paper-tab>
        </template>
      </paper-tabs>
      <paper-tabs id="roomTabs" class="room-tabs" selected="{{room}}" scrollable on-tap="_onRoomSelect">
        <template is="dom-repeat" items="[[_rooms]]" index-as="index" strip-whitespace>
          <paper-tab class="room-tab">[[item]]</paper-tab>
        </template>
      </paper-tabs>
    </iron-collapse>
    <iron-pages selected="[[selectedView]]" attr-for-selected="view">
      <!-- <div view="loading" class="loading-view">
        <paper-spinner-lite active></paper-spinner-lite>
      </div> -->
      <div view="day" class="day-view">
        <div class="day-view-today">
          <span>[[_todayDate]]</span>
          <span>[[_getDayName(_todayIdx)]]</span>
        </div>
        <iron-list items="[[_day]]">
          <template strip-whitespace>
            <div class="day-hour">
              <div class="day-hour-label">[[item]]</div>
              <div class="day-hour-content">
              </div>
            </div>
          </template>
        </iron-list>
      </div>
      <div view="week" class="week-view">
        <div class="week-view-date">
          <template is="dom-repeat" items="[[_week]]" index-as="index" strip-whitespace>
            <div class="week-view-date-each">
              <span class$="[[_isToday(item.today)]]">[[item.date]]</span>
              <span class$="[[_isToday(item.today)]]">[[_getDayName(item.dayIdx)]]</span>
            </div>
          </template>
        </div>
        <div class="week-view-date-hour">
          <iron-list items="[[_day]]">
            <template strip-whitespace>
              <div class="week-view-day-hour">
                <div class="">
                  <span class="week-view-day-hour-label">[[item]]</span>
                </div>

                <div class="week-view-day-hour-row">
                  <div class$="week-view-day-hour-item[[_isTodayCol(_todayIdx, 0)]]" day="sun">[[item]]</div>
                  <div class$="week-view-day-hour-item[[_isTodayCol(_todayIdx, 1)]]" day="mon">[[item]]</div>
                  <div class$="week-view-day-hour-item[[_isTodayCol(_todayIdx, 2)]]" day="tue">[[item]]</div>
                  <div class$="week-view-day-hour-item[[_isTodayCol(_todayIdx, 3)]]" day="wed">[[item]]</div>

                  <div class$="week-view-day-hour-item[[_isTodayCol(_todayIdx, 4)]]" day="thu">[[item]]</div>
                  <div class$="week-view-day-hour-item[[_isTodayCol(_todayIdx, 5)]]" day="fri">[[item]]</div>
                  <div class$="week-view-day-hour-item[[_isTodayCol(_todayIdx, 6)]]" day="sat">[[item]]</div>
                </div>
              </div>
            </template>
          </iron-list>
        </div>
      </div>
      <div view="month" class="month-view">
        <div class="month-view-weekday">
          <template is="dom-repeat" items="[[_weekdayName]]" index-as="index" strip-whitespace>
            <div class="month-view-weekday-day">
              <span class$="[[_isTodayDay(_todayIdx, index)]]">[[item]]</span>
            </div>
          </template>
        </div>
        <div class="month-view-month">
          <template is="dom-repeat" items="[[_month]]" index-as="index" strip-whitespace>
            <div class="month-view-month-day">
              <span class$="[[_isTodayMonth(_todayDate, item)]]">[[item]]</span>
            </div>
          </template>
        </div>
      </div>
    </iron-pages>
  </template>
  <script>
  (function() {
    'use strict';

    var _sitesCode = ['alpha', 'beta', 'gamma'];
    var _floorsCode = [
      '01level', '02level', '03level', '04level', '05level', '06level',
      '07level', '08level', '09level', '10level', '11level', '12level'
    ];
    var _allrooms = {
      'alpha': {
        '01level': ['freedom tower', 'taipei 101', 'the shard', 'twin towers', 'willis tower'],
        '02level': ['acetyls', 'aromatics', 'bitumen', 'hydrocarbon', 'lubricant', 'olefin'],
        '03level': ['dowjones', 'euronext', 'ftse', 'hangseng', 'nikkei'],
        '04level': ['austen', 'dickens', 'eliot', 'rowling', 'twain'],
        '05level': ['daffodil', 'golden wattle', 'hibiscus', 'orchid', 'protea',
        'raflesia', 'rose', 'tulip'],
        '06level': ['courage', 'excellence', 'one team', 'respect', 'values'],
        '07level': ['alpha', 'beta', 'delta', 'gamma', 'kappa', 'omega', 'sigma', 'zeta'],
        '08level': ['angsana', 'cendana', 'chengal', 'jati', 'meranti', 'seraya', 'teak'],
        '09level': [
          'batu caves', 'batu ferringi', 'cherating', 'gunung ledang',
          'jonker street', 'kinabalu', 'klcc', 'lake melati', 'limestone',
          'minangkabau', 'putrajaya', 'silat', 'songket', 'wellness room'],
        '10level': [
          'degas', 'michaelangelo', 'monet', 'picasso',
          'renoir', 'sisley', 'van gogh'],
        '11level': [
          'anise', 'cardamom', 'cinnamon', 'clove', 'peppercorn', 'sesame',
          'tamarind', 'tumeric'],
        '12level': [
          'amethyst', 'diamond', 'emerald', 'garnet', 'pearl',
          'sapphire', 'topaz', 'zircon']
      },
      'beta': {
        '03level': [
          'benz', 'edison', 'einstein', 'fleming', 'franklin', 'graham',
          'newton', 'whitney']
      },
      'gamma': {
        '01level': [
          'collaborate', 'create', 'fun', 'grow', 'idea', 'innovate',
          'inspire', 'lead', 'meet', 'team', 'think']
      }
    };

    Polymer({
      is: 'semafloor-console-page',

      properties: {
        selectedView: {
          type: String,
          value: 'week'
        },
        site: {
          type: Number,
          value: 0
        },
        floor: {
          type: Number,
          value: 0
        },
        room: {
          type: Number,
          value: 0
        },
        _selectedRoomName: {
          type: String,
          value: 'freedom tower'
        },
        _selectRoomOnTap: Boolean,
        _todayIdx: Number,
        _todayDate: Number,
        _floors: Array,
        _rooms: Array,
        _prevFloor: Number,
        _day: {
          type: Array,
          value: function() {
            return [
              '08:00', '08:30', '09:00', '09:30', '10:00', '10:30', '11:00',
              '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30',
              '15:00', '15:30', '16:00', '16:30', '17:00', '17:30', '18:00',
              '18:30', '19:00', '19:30', '20:00', '20:30', '21:00', '21:30',
              '22:00', '22:30', '23:00', '23:30'];
          }
        },
        _week: {
          type: Array,
          value: function() {
            var _now = new Date();
            var _week = [' '];
            var _offset = _now.getDate() - _now.getDay();
            var _today;
            var _new;
            var _isToday;
            var _default = new Date(_now.getFullYear(), _now.getMonth(), _now.getDate());
            for (var i = 0; i < 7; i++) {
              _today = new Date(_now.setDate(_offset + i));
              _new = new Date(_today.getFullYear(), _today.getMonth(), _today.getDate());
              _isToday = _new.getTime() < _default.getTime() ? 'yesterday' :
              _new.getTime() === _default.getTime() ? 'today' : 'tomorrow';
              if (_isToday === 'today') {
                this.set('_todayIdx', _new.getDay());
                this.set('_todayDate', _new.getDate());
              }
              _week.push({
                date: _today.getDate(),
                dayIdx: _today.getDay(),
                today: _isToday
              });
            }
            return _week;
          }
        },
        _month: {
          type: Array,
          value: function() {
            function _computeTotalDays(_year, _month) {
              var _total = 31;
              if (_month === 1) {
                _total = new Date(_year, 1, 29).getMonth() === 1 ? 29 : 28;
              }else if (_month === 4 || _month === 6 || _month === 9 || _month === 11) {
                _total = 30;
              }
              return _total;
            }

            var _now = new Date();
            var _start = new Date(_now.getFullYear(), _now.getMonth(), 1).getDay();
            var _month = [];
            var _totalDays = _computeTotalDays(_now.getFullYear(), _now.getMonth() + 1);
            for (var i = 0, j = 1 - _start; i < 42; i++) {
              _month.push((i >= _start && i < _start + _totalDays ? j : ''));
              j++;
            }
            return _month;
          }
        },
        _weekdayName: {
          teyp: Array,
          value: function() {
            return ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
          }
        },

      },

      observers: [
        '_setFloor(site)',
        '_setPrevFloor(floor)',
        '_setRoom(site, floor)',
        '_selectRoom(room)'
      ],

      _getDayName: function(_dayIdx) {
        return ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][_dayIdx];
      },

      _setFloor: function(_site) {
        this.set('_floors', [['1', '2', '3', '3A', '4', '5', '6',
        '7', '8', '9', '10', '11', '12'], ['3'], ['1']][_site]);
        if (_site === 0 && this._prevFloor) {
          this.set('floor', this._prevFloor);
        }else {
          this.set('floor', 0);
        }
        this.set('room', 0);
        this.$.floorTabs.notifyResize();
        this.$.roomTabs.notifyResize();
      },

      _setPrevFloor: function(_floor) {
        if (this.site === 0) {
          this.set('_prevFloor', _floor);
        }
        this.set('room', 0);
        this.$.roomTabs.notifyResize();
      },

      _setRoom: function(_site, _floor) {
        var _decodedSite = _sitesCode[_site];
        var _decodedFloor = _site > 1 ? '01level' :
        (_site > 0 ? '03level' : _floorsCode[_floor]);
        this.set('_rooms', _allrooms[_decodedSite][_decodedFloor]);
      },

      _isToday: function(_today) {
        return _today ? _today : '';
      },
      _isTodayCol: function(_today, _compareIdx) {
        return _today === _compareIdx ? ' is-today-col' : '';
      },
      _isTodayMonth: function(_todayDate, _item) {
        return _todayDate === _item ? 'is-today-month' : '';
      },
      _isTodayDay: function(_todayDayIdx, _index) {
        return _todayDayIdx === _index ? 'is-today-idx' : '';
      },

      _toggleCollapse: function() {
        this.$.selectionCollapse.toggle();
        this.toggleClass('menu-drop-down-up', this.$.selectionCollapse.opened,
        this.$.menuDropDown);
        // notifyResize once toggle.
        this.$.siteTabs.notifyResize();
        this.$.floorTabs.notifyResize();
        this.$.roomTabs.notifyResize();
      },
      _onRoomSelect: function() {
        this.set('_selectRoomOnTap', true);
        this.$.selectionCollapse.hide();
        this.toggleClass('menu-drop-down-up', this.$.selectionCollapse.opened,
        this.$.menuDropDown);
      },
      _selectRoom: function(_room) {
        if (this._selectRoomOnTap) {
          var _site = this.site;
          var _decodedSite = _sitesCode[_site];
          var _decodedFloor = _site > 1 ? '01level' :
          (_site > 0 ? '03level' : _floorsCode[this.floor]);
          var _result = _allrooms[_decodedSite][_decodedFloor];
          this.set('_selectedRoomName', _result[_room]);
        }
        this.set('_selectRoomOnTap', false);
      },

      _prevDayWeekMonth: function(ev) {
        var _target = ev.target;
      },

      _nextDayWeekMonth: function(ev) {
        var _target = ev.target;
      },

    });
  })();
  </script>
</dom-module>
